<html>
  <head>
    <!-- Load plotly.js into the DOM -->
    <script src='https://cdn.plot.ly/plotly-2.4.2.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js'></script>
	  
    <!-- gstatic chart loader -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>  
  </head>

  <body>
	<div>
		<div><a href="https://docs.google.com/spreadsheets/d/19pvUkYDkw19fO9hlgHlSsrQgzzli8aNLkJo0A3EW51E/copy" target="_blank">Data entry template</a></div>
		<div>
			<label for="spreadsheetURL">Spreadsheet URL:</label>
			<input type="url" id="spreadsheetURL" name="spreadsheetURL">
		</div>
		<div><button onclick="generateGraph()">Generate Graph</button></div>
	</div>
	<div id='surfacePlot'><!-- Plotly chart will be drawn inside this DIV --></div>
	<script>

google.charts.load('current');
google.charts.setOnLoadCallback(init);

function init() {
}
		
function generateGraph() {

	// var url = 'https://docs.google.com/spreadsheets/d/19pvUkYDkw19fO9hlgHlSsrQgzzli8aNLkJo0A3EW51E/edit#gid=0';

	
	// get spreadsheetURL from text field
	var url = document.getElementById('spreadsheetURL').value;

	// validate URL
  	let testURL;
  
	try {
		testURL = new URL(url);
	} catch (_) {
		alert(url + " is not a valid URL");
		return false;  
	}	
	
	var query = new google.visualization.Query(url);
	query.setQuery('select B,C,D,E,F,G,H,I,J,K,L,M,N');
	query.send(processSheetsData);
}
	    
function processSheetsData(response) {
	var z_data = [];
	var data = response.getDataTable();
	var columns = data.getNumberOfColumns();
	var rows = data.getNumberOfRows();
	for (var c = 0; c < columns; c++) {
		var col = [];
		for (var r = 0; r < rows; r++) {
			// check if value is not a number
			var rowValue = r + 1;
			var formattedValue = data.getFormattedValue(r, c);
			console.log(typeof(formattedValue));
			if (Number.isNaN(formattedValue)) {
				alert("Value: " + formattedValue + " at " + String.fromCharCode(65 + c) + ":" + rowValue.toString() + " is not a number.")
				return false;
			} else {
				col.push(formattedValue);
			}
		}
		z_data.push(col);
	}

	// console.log(z_data);

	var data = [{
		z: z_data,
		type: 'surface'
	}];

	var layout = {
		title: 'Map of Sea Floor',
		autosize: true,
		width: 750,
		height: 750,
		margin: {
		l: 65,
		r: 50,
		b: 65,
		t: 90,
		}
	};
		
	Plotly.newPlot('surfacePlot', data, layout);
}
    </script>	  
  </body>
</html>
